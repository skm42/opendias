#!/bin/sh
# preinst script for opendias
#
# see: dh_installdeb(1)

set -e
OPENDIAS_USER=opendias

# summary of how this script can be called:
#        * <new-preinst> `install'
#        * <new-preinst> `install' <old-version>
#        * <new-preinst> `upgrade' <old-version>
#        * <old-preinst> `abort-upgrade' <new-version>
# for details, see http://www.debian.org/doc/debian-policy/ or
# the debian-policy package


case "$1" in
    install)
	adduser --disabled-password --gecos 'opendias User' $OPENDIAS_USER
	usermod -G scanner $OPENDIAS_USER


	#udev generated by dh_installudev
	if [ -e "/etc/udev/rules.d/z60_opendias.rules" ]; then
		if [ "`md5sum \"/etc/udev/rules.d/z60_opendias.rules\" | sed -e \"s/ .*//\"`" = \
			"`dpkg-query -W -f='${Conffiles}' opendias | sed -n -e \"\\\\' /etc/udev/rules.d/z60_opendias.rules '{s/ obsolete$//;s/.* //p}\"`" ]
                then
                        rm -f "/etc/udev/rules.d/z60_opendias.rules"
                fi
        fi

    ;;
    upgrade)
    ;;

    abort-upgrade)
    ;;

    *)
        echo "preinst called with unknown argument \`$1'" >&2
        exit 1
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
